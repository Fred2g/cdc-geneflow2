name: image-build-with-arc

on:
  # Configure Manual Trigger
  workflow_dispatch:

permissions: write-all
jobs: 
  build: 
    name: Build image 
    runs-on: arc-runner-set 
    steps: 
    - uses: actions/checkout@v3 
    - name: Buildah Action 
      uses: redhat-actions/buildah-build@v2 
      with: 
        image: cdc/geneflow2
        tags: v1 ${{ github.sha }} 
        containerfiles: | 
          ./docker/Dockerfile
        # build-args: | 
        #   some_arg=some_value

# jobs:
#   anchore_scan_job:
#     runs-on: arc-runner-set #ubuntu-latest
#     name: Anchore grype security scan on ARC
#     steps:
#     - name: Checkout
#       uses: actions/checkout@v2
    
#     # - name: Scan current project
#     #   id: scan
#     #   uses: anchore/scan-action@v3
#     #   with:
#     #     path: "./"
#     #     fail-build: true
#     #     acs-report-enable: true
    
#     # - name: upload Anchore scan SARIF report
#     #   uses: github/codeql-action/upload-sarif@v2
#     #   with:
#     #     sarif_file: ${{ steps.scan.outputs.sarif }}
    
#     # - name: Set up Docker Buildx
#     #   uses: docker/setup-buildx-action@v1

#     - name: build local container
#       uses: elgohr/Publish-Docker-Github-Action@v5 # docker/build-push-action@v2
#       with:
#         tags: cdc/geneflow2:latest
#         file: ./docker/Dockerfile
#         push: false
#         load: true

#     # - name: Scan image
#     #   uses: anchore/scan-action@v3
#     #   id: imagescan
#     #   with:
#     #     image: "cdc/geneflow2:latest"
#     #     acs-report-enable: "true"
#     #     fail-build: false

#     # - name: upload Anchore Image scan SARIF report
#     #   uses: github/codeql-action/upload-sarif@v2
#     #   with:
#     #     sarif_file: ${{ steps.imagescan.outputs.sarif }}

#     - name: Syft SBOM
#       uses: anchore/sbom-action@v0
#       with:
#         image: "cdc/geneflow2:latest"
